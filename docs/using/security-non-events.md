# Sandstorm Security Non-events

This page contains a partial list of security issues that have not affected web apps when they run in Sandstorm -- typically because of the hardening we do to apps, or because of the hardening we do against the attack surface of the Linux kernel. The purpose is to demonstrate that our [security practices](security-practices) provide some degree of useful protection in the face of real-world vulnerabilities.

A few notes first:

* Security is risk-management, not binary. No software, Sandstorm included, will ever protect all user data from all bugs in all programs. But, raising barriers to a successful attack means fewer successful attacks will occur, which is obviously valuable. Sandstorm aims to reduce the risk of attack by an order of magnitude or more.
* Most real-world attacks do not involve novel new techniques or genius insights. Instead, attackers exploit the sad reality that most developers simply don't think carefully about their code. Developers often concern themselves primarily with making their code work in the common case; few developers ask themselves: "What is every possible path this code could take?" As a result, most apps are simply full of security bugs, and anyone looking for bugs in a particular app will find many in short order. Sandstorm therefore aims to (1) mitigate common app bugs, and (2) confine the damage caused by bugs it can't mitigate.
* Of course, Sandstorm itself could be buggy, but Sandstorm is written by security nerds -- the kind of people who do ask themselves "What is every possible path this code could take?" Moreover, we plan to commission an outside security review before version 1.0. Hopefully, the chance of bugs in Sandstorm is much less than the chance of bugs in an average app.
* The list below is not even remotely complete. Rather, it is a sample of the few bugs we've actually researched.

## Etherpad

On Sandstorm, every Etherpad instance hosts only a single document. Only users with whom that document has been shared (with at least read access) are able to interact with the Etherpad instance in any way. Therefore, it is nearly impossible for Etherpad to have a significant security issue on Sandstorm: in order to exploit the issue against a particular document, you would already have to have access to that document, probably making the attack moot. The only plausible security issues are: (a) vulnerabilities allowing escalation of read-only privileges to edit privileges, and (b) vulnerabilities allowing a user to tamper with the edit history, e.g. to make their edits appear to be attributed to someone else. Both of these would be relatively minor issues.

Etherpad has had actual bugs that have been mitigated on Sandstorm:

* [CVE-2015-3297](http://www.openwall.com/lists/oss-security/2015/04/12/1), [4085](http://www.openwall.com/lists/oss-security/2015/05/26/3): Path injection bugs could allow remotely dumping arbitrary files from the server's filesystem, including the Etherpad database, leaking pad contents and user credentials (session tokens). On Sandstorm, Etherpad can only see its own package contents and database, not files belonging to other apps or the system, so it can only leak its own data. The main damage from that -- leaking pad contents -- doesn't matter on Sandstorm because to launch the attack the attacker would need read access already (as described above). Meanwhile, leaking session tokens could normally (outside Sandstorm) allow impersonation of other users, but on Sandstorm Etehrpad relies on Sandstorm for authentication, and only uses session tokens to disambiguate anonymous users. Thus, on Sandstorm, this bug could be exploited to allow one user with edit access to impersonate some other anonymous user (forging edit history), but not to impersonate a logged-in user.

* [CVE-2015-2298](http://www.openwall.com/lists/oss-security/2015/03/15/3): Due to a malformed database query, a request to export a pad by ID would in fact return contents of all pads on the server which had the specified ID as a substring of their own. Thus, all pads on the server could be dumped by specifying a series of one-character IDs (or maybe in a single query with an empty ID). This bug is irrelevant on Sandstorm because the attacker would need already to have read access to launch the attack (as described above).

## WordPress

The WordPress app on Sandstorm is used to publish public web sites. However, the app does not respond to individual page views of that site. Instead, the app generates static content which it hands off to Sandstorm, and Sandstorm serves the site statically. The site administrator accesses WordPress's administrative interface through Sandstorm like any other app, but visitors to the public site visit a separate hostname where they don't see Sandstorm at all. The site owner may share access to the edit UI but would never share this access publicly.

As a result of this model, there is no way to exploit a bug in WordPress on Sandstorm if you only have access to the published site, because there is no way for you to cause any WordPress code to execute at all. The site owner must explicitly share access to the admin interface with you before you can interact with the app.

Additionally, because the WordPress admin interface is served through Sandstorm [on a random, unguessable hostname](security-practices.md#client-sandboxing), CSRF attacks are far more difficult to carry out against this interface. (They are not impossible, but they require a passive MITM of network traffic or other information leaks to carry out.)

This model has a downside: comments are currently not supported. However, with some engineering effort, comments could be re-enabled while maintaining strong security. To accomplish this, the public-facing web site would use client-side Javascript to communicate with an HTTP API exported by the Sandstorm app whenever a user posts a comment. In order to prevent vulnerabilities in the comment-handling code from threatening core site administration, comments could be managed by a separate app that runs in a separate grain (container) from the core site. With the right design, there is no need for information about comments to flow into the core site management, so vulnerabilities in the comment infrastructure would at worst allow an attacker to deface other users' comments, not the whole web site.

[WordPress has reported many vulnerabilities](http://www.cvedetails.com/vulnerability-list/vendor_id-2337/product_id-4096/). Below, we cover all WordPress CVEs scored with a severity of 6 or more in 2014 and 2015.

* [CVE-2015-5731](http://www.cvedetails.com/cve/CVE-2015-5731/): A CSRF vulnerability allows exercising admin's ability to lock posts. Sandstorm provides additional CSRF protection as described above.
* [CVE-2015-2213](http://www.cvedetails.com/cve/CVE-2015-2213/): XSS in comments. WordPress on Sandstorm currently does not support comments, but see the discussion of comments above.
* [CVE-2015-9038](http://www.cvedetails.com/cve/CVE-2014-9038/): Unauthenticated attacker can cause the WordPress server to make HTTP requests back to itself which may be given more authority than remote requests would. On Sandstorm, only editors/admins would be able to exploit the vulnerability.
* [CVE-2015-9037](http://www.cvedetails.com/cve/CVE-2014-9037/): Bug in authentication code could allow hijacking long-dormant accounts that used an older password hash algorithm. Sandstorm unaffected because WordPress on Sandstorm relies on Sandstorm for authentication.
* [CVE-2014-9033](http://www.cvedetails.com/cve/CVE-2014-9033/): CSRF in password reset flow. WordPress on Sandstorm not vulnerable because it relies on Sandstorm for authentication and does not implement its own passwords.
* [CVE-2014-5205](http://www.cvedetails.com/cve/CVE-2014-5205/), [5204](http://www.cvedetails.com/cve/CVE-2014-5204/): Possible bypass of CSRF protections. Sandstorm adds additional protection by putting the admin interface on a randomized hostname.
* [CVE-2014-5203](http://www.cvedetails.com/cve/CVE-2014-5203/): Unauthenticated attacker can cause arbitrary code execution via malicious serialized data. On Sansdtorm, only editors/admins could exploit this.
* [CVE-2014-0166](http://www.cvedetails.com/cve/CVE-2014-0166/): Possible to forge authentication cookies. WordPress on Sandstorm not vulnerable because it relies on Sandstorm (not cookies) for authentication.

## Roundcube

When using Roundcube for email on Sandstorm, each user creates a unique grain of the app. This is by contrast with standard Roundcube, where a central install serves multiple users.

* [CVE-2015-5381](https://security-tracker.debian.org/tracker/CVE-2015-5381): Reflected cross-site scripting. Sandstorm mitigates reflected-XSS attacks in much the same way it mitigates CSRF attacks: the attacker would have to know the app's randomly-generated hostname for the attack to work. An attacker with passive network MITM abilities or some other way of obtaining the hostname might be able to carry out an attack, but this is a much higher bar than outside of Sandstorm.
* [CVE-2015-5382](https://security-tracker.debian.org/tracker/CVE-2015-5382): Reading arbitrary files on the filesystem. Much like with similar Etherpad issues, this is irrelevant on Sandstorm because each Roundcube mailbox runs as a separate instance of the app in an isolated container, these instances cannot see each other's files, and there is no way to send requests to a particular mailbox instance unless the owner has explicitly shared access with you.
* [CVE-2015-5385](https://security-tracker.debian.org/tracker/CVE-2015-5383): Log data leakage. Irrelevant on Sandstorm because each Roundcube mailbox has a separate log file visible only to it.

## Linux kernel

The Linux kernel has had many bugs that could allow any local process to gain root privileges or otherwise bypass security rules. Sandstorm blocks most of these vulnerabilities by virtue of its [server-side sandbox](security-practices.md#server-sandboxing) which disables much of the Linux kernel API thereby reducing the surface of attack only to core, well-reviewed functionality.

Some bugs blocked include:

* [CVE-2013-1956](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2013-1956), [1957](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2013-1957), [1958](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2013-1958), [1959](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2013-1959), [1979](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2013-1979), [CVE-2014-4014](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-4014), [5206](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-5206), [5207](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-5207), [7970](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-7970), [7975](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-7975), etc.: The introduction of unprivileged user namespaces lead to a huge increase in the attack surface available to unprivileged users by giving such users legitimate access to previously root-only system calls like `mount()`. All of these CVEs are examples of security vulnerabilities due to introduction of user namespaces. Sandstorm uses user namespaces to set up its own sandbox, but then disallows the sandboxed app from creating its own nested namespaces, rendering these vulnerabilities unexploitable.
* [CVE-2014-0181](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-0181): Passing a netlink socket as stdout/stderr of a setuid program could trick the program into performing privileged operations on the socket. Setuid binaries are disabled in the Sandstorm sandbox.
* [CVE-2014-4699](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-4699): A bug in `ptrace()` could allow privilege escalation. Sandstorm disables `ptrace()` inside the sandbox.
* [CVE-2015-3290](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-3290), [5157](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-5157): Bugs in the kernel's non-maskable interrupt handling allowed privilege escalation. Can't be exploited on Sandstorm because the `modify_ldt()` system call is blocked.
