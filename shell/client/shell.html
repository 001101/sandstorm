<!--
Sandstorm - Personal Cloud Sandbox
Copyright (c) 2014, Kenton Varda <temporal@gmail.com>
All rights reserved.

This file is part of the Sandstorm platform implementation.

Sandstorm is free software: you can redistribute it and/or modify
it under the terms of the GNU Affero General Public License as
published by the Free Software Foundation, either version 3 of the
License, or (at your option) any later version.

Sandstorm is distributed in the hope that it will be useful, but
WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
Affero General Public License for more details.

You should have received a copy of the GNU Affero General Public
License along with Sandstorm.  If not, see
<http://www.gnu.org/licenses/>.
-->

<head>
  <title>Sandstorm</title>
  <script type="text/javascript" src="/logo.js"></script>
</head>

<body>
  <div id="topbar-left">
    {{> grainList}}
  </div>
  <div id="topbar">
    Sandstorm
  </div>
  <div id="topbar-right">
    {{loginButtons align="right"}}
  </div>
</body>

<template name="grainList">
  {{#if currentUser}}<span id="apps-ico">Files â–¾</span>{{/if}}
  <div id="apps" class="popup">
    <table><tr><td>
    <h1>Open</h1>
    {{#each grains}}
    <p class="openGrain" id="openGrain-{{grainid}}">{{title}}
    {{else}}
    <p><i>You have no files...</i>
    {{/each}}
    </td><td>
    <h1>New</h1>
    {{#each actions}}
    <p class="newGrain" id="newGrain-{{_id}}">{{title}}
    {{else}}
    <p><i>You have no apps...</i>
    {{/each}}
    </td></tr><table>
  </div>
</template>

<template name="root">
  <div id="intro">
    <div id="logo">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1">
      </svg>
    </div>
    <h1>Sandstorm</h1>
    <p>Looking for an app?
      <a href="install/81d4758636d6a947dc3e6825f080199a?url=http://{{host}}/etherpad.spk">
      Try Etherpad</a>
  </div>
</template>

<template name="grain">
  <div id="app">
    {{#if error}}
      <pre>{{error}}</pre>
    {{else}}
    {{#if port}}
      <iframe src="http://localhost:{{port}}/_sandstorm-init?sessionid={{sessionid}}"></iframe>
    {{else}}
      <p>Loading app...
    {{/if}}
    {{/if}}
  </div>
</template>

<template name="install">
  {{#if error}}
    <div id="install" class="error">
      <p>Failed to install app!
        {{#if step}}<button id="retry">Try Again</button>{{/if}}
      <pre>{{error}}</pre>
    </div>
  {{else}}
    <div id="install" class="instep-{{step}}">
      <ol>
        <li id="step-download">Download... <span class="progress">{{progress}}
            <button id="cancelDownload">Cancel</button></span>
        <li id="step-verify">Verify... <span class="progress">{{progress}}</span>
        <li id="step-unpack">Unpack... <span class="progress">{{progress}}</span>
        <li id="step-analyze">Analyze... <span class="progress">{{progress}}</span>
        <li id="step-confirm">Confirm...
          <div class="confirm-form">
            <p>Do you really want to install this app?
            <!--(TODO(someday):  Support upgrades, petnames.)-->
            <p><button id="confirmInstall">Install</button>
          </div>
        <li id="step-run">Run...
          <div class="done-notice">
            <p>Installation complete.  Click "My Grains" to create a new grain with this app.
          </div>
      </ol>
    </div>
  {{/if}}
</template>
